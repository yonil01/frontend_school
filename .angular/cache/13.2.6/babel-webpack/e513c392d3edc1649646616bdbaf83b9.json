{"ast":null,"code":"import _asyncToGenerator from \"D:\\\\Repositories\\\\Trabajo\\\\ecatch-web-config\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";\nimport { __decorate } from \"tslib\";\nimport { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { FormControl } from \"@angular/forms\";\nimport { editAttribute } from \"@app/core/store/actions/entity.action\";\nimport { v4 as uuidv4 } from 'uuid';\nlet EntityAddDatasetComponent = class EntityAddDatasetComponent {\n  constructor(datasetsService, entityService, store, _fb) {\n    this.datasetsService = datasetsService;\n    this.entityService = entityService;\n    this.store = store;\n    this._fb = _fb;\n    this.onSubmit = new EventEmitter();\n    this.message = new EventEmitter();\n    this.datasets = [];\n    this.datasetsLoaded = false;\n    this.datasetForm = this._fb.group({\n      dataset: new FormControl(null)\n    });\n  }\n\n  ngOnInit() {\n    this.datasetsService.getDatasets().subscribe(res => {\n      var _a, _b, _c;\n\n      this.datasets = res.data;\n      this.datasetsLoaded = true;\n      console.log(this.datasets);\n\n      if ((_a = this.attribute) === null || _a === void 0 ? void 0 : _a.entities_attributes_dataset) {\n        const dataset = this.datasets.find(dts => dts.id.toLowerCase() === this.attribute.entities_attributes_dataset.id.toLowerCase());\n        (_b = this.datasetForm.get('dataset')) === null || _b === void 0 ? void 0 : _b.setValue(dataset);\n      } else {\n        (_c = this.datasetForm.get('dataset')) === null || _c === void 0 ? void 0 : _c.value.setValue(null);\n      }\n    });\n  }\n\n  save() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      var _a, _b;\n\n      if ((_a = _this.attribute) === null || _a === void 0 ? void 0 : _a.entities_attributes_dataset) {\n        yield _this.deleteAttributeDataset();\n      }\n\n      if (_this.datasetForm.value) {\n        const attributeDatasetPersistence = {\n          id: uuidv4().toLowerCase(),\n          attributes_id: _this.attribute.id.toLowerCase(),\n          dataset_id: (_b = _this.datasetForm.get('dataset')) === null || _b === void 0 ? void 0 : _b.value.toLowerCase()\n        };\n\n        _this.entityService.createAttributeDataset(attributeDatasetPersistence).subscribe(res => {\n          var _a;\n\n          if (!res.error) {\n            const attribute = Object.assign(Object.assign({}, _this.attribute), {\n              entities_attributes_dataset: (_a = _this.datasetForm.get('dataset')) === null || _a === void 0 ? void 0 : _a.value\n            });\n\n            _this.store.dispatch(editAttribute({\n              attribute: attribute\n            }));\n\n            _this.datasetForm.setValue(null);\n\n            _this.message.emit({\n              type: 'success',\n              message: 'Cambios guardados con éxito',\n              life: 5000\n            });\n\n            _this.onSubmit.emit({\n              id: 'dataset',\n              from: 'attribute',\n              value: true\n            });\n          } else {\n            _this.message.emit({\n              type: 'error',\n              message: res.error,\n              life: 5000\n            });\n          }\n        });\n      } else {\n        const attribute = Object.assign(Object.assign({}, _this.attribute), {\n          entities_attributes_dataset: null\n        });\n\n        _this.store.dispatch(editAttribute({\n          attribute: attribute\n        }));\n\n        _this.onSubmit.emit({\n          id: 'dataset',\n          from: 'attribute',\n          value: true\n        });\n      }\n    })();\n  }\n\n  deleteAttributeDataset() {\n    return new Promise((resolv, rej) => {\n      this.entityService.DeleteAttributeDatasetByAttIDAndDatasetID(this.attribute.id.toLowerCase(), this.attribute.entities_attributes_dataset.id.toLowerCase()).subscribe(res => {\n        if (res.error) rej(true);\n        resolv(!res.error);\n      });\n    });\n  }\n\n  cancel() {\n    this.onSubmit.emit({\n      id: 'dataset',\n      from: 'attribute',\n      value: true\n    });\n  }\n\n};\n\n__decorate([Input()], EntityAddDatasetComponent.prototype, \"attribute\", void 0);\n\n__decorate([Output()], EntityAddDatasetComponent.prototype, \"onSubmit\", void 0);\n\n__decorate([Output()], EntityAddDatasetComponent.prototype, \"message\", void 0);\n\nEntityAddDatasetComponent = __decorate([Component({\n  selector: 'app-entity-add-dataset',\n  templateUrl: './entity-add-dataset.component.html',\n  styleUrls: ['./entity-add-dataset.component.scss']\n})], EntityAddDatasetComponent);\nexport { EntityAddDatasetComponent };","map":{"version":3,"sources":["D:/Repositories/Trabajo/ecatch-web-config/src/app/modules/wizard/entidades/components/entity-add-dataset/entity-add-dataset.component.ts"],"names":["__decorate","Component","EventEmitter","Input","Output","FormControl","editAttribute","v4","uuidv4","EntityAddDatasetComponent","constructor","datasetsService","entityService","store","_fb","onSubmit","message","datasets","datasetsLoaded","datasetForm","group","dataset","ngOnInit","getDatasets","subscribe","res","_a","_b","_c","data","console","log","attribute","entities_attributes_dataset","find","dts","id","toLowerCase","get","setValue","value","save","deleteAttributeDataset","attributeDatasetPersistence","attributes_id","dataset_id","createAttributeDataset","error","Object","assign","dispatch","emit","type","life","from","Promise","resolv","rej","DeleteAttributeDatasetByAttIDAndDatasetID","cancel","prototype","selector","templateUrl","styleUrls"],"mappings":";AAAA,SAASA,UAAT,QAA2B,OAA3B;AACA,SAASC,SAAT,EAAoBC,YAApB,EAAkCC,KAAlC,EAAyCC,MAAzC,QAAuD,eAAvD;AACA,SAASC,WAAT,QAA4B,gBAA5B;AACA,SAASC,aAAT,QAA8B,uCAA9B;AACA,SAASC,EAAE,IAAIC,MAAf,QAA6B,MAA7B;AACA,IAAIC,yBAAyB,GAAG,MAAMA,yBAAN,CAAgC;AAC5DC,EAAAA,WAAW,CAACC,eAAD,EAAkBC,aAAlB,EAAiCC,KAAjC,EAAwCC,GAAxC,EAA6C;AACpD,SAAKH,eAAL,GAAuBA,eAAvB;AACA,SAAKC,aAAL,GAAqBA,aAArB;AACA,SAAKC,KAAL,GAAaA,KAAb;AACA,SAAKC,GAAL,GAAWA,GAAX;AACA,SAAKC,QAAL,GAAgB,IAAIb,YAAJ,EAAhB;AACA,SAAKc,OAAL,GAAe,IAAId,YAAJ,EAAf;AACA,SAAKe,QAAL,GAAgB,EAAhB;AACA,SAAKC,cAAL,GAAsB,KAAtB;AACA,SAAKC,WAAL,GAAmB,KAAKL,GAAL,CAASM,KAAT,CAAe;AAC9BC,MAAAA,OAAO,EAAE,IAAIhB,WAAJ,CAAgB,IAAhB;AADqB,KAAf,CAAnB;AAGH;;AACDiB,EAAAA,QAAQ,GAAG;AACP,SAAKX,eAAL,CAAqBY,WAArB,GAAmCC,SAAnC,CAA8CC,GAAD,IAAS;AAClD,UAAIC,EAAJ,EAAQC,EAAR,EAAYC,EAAZ;;AACA,WAAKX,QAAL,GAAgBQ,GAAG,CAACI,IAApB;AACA,WAAKX,cAAL,GAAsB,IAAtB;AACAY,MAAAA,OAAO,CAACC,GAAR,CAAY,KAAKd,QAAjB;;AACA,UAAI,CAACS,EAAE,GAAG,KAAKM,SAAX,MAA0B,IAA1B,IAAkCN,EAAE,KAAK,KAAK,CAA9C,GAAkD,KAAK,CAAvD,GAA2DA,EAAE,CAACO,2BAAlE,EAA+F;AAC3F,cAAMZ,OAAO,GAAG,KAAKJ,QAAL,CAAciB,IAAd,CAAoBC,GAAD,IAASA,GAAG,CAACC,EAAJ,CAAOC,WAAP,OAAyB,KAAKL,SAAL,CAAeC,2BAAf,CAA2CG,EAA3C,CAA8CC,WAA9C,EAArD,CAAhB;AACA,SAACV,EAAE,GAAG,KAAKR,WAAL,CAAiBmB,GAAjB,CAAqB,SAArB,CAAN,MAA2C,IAA3C,IAAmDX,EAAE,KAAK,KAAK,CAA/D,GAAmE,KAAK,CAAxE,GAA4EA,EAAE,CAACY,QAAH,CAAYlB,OAAZ,CAA5E;AACH,OAHD,MAIK;AACD,SAACO,EAAE,GAAG,KAAKT,WAAL,CAAiBmB,GAAjB,CAAqB,SAArB,CAAN,MAA2C,IAA3C,IAAmDV,EAAE,KAAK,KAAK,CAA/D,GAAmE,KAAK,CAAxE,GAA4EA,EAAE,CAACY,KAAH,CAASD,QAAT,CAAkB,IAAlB,CAA5E;AACH;AACJ,KAZD;AAaH;;AACKE,EAAAA,IAAI,GAAG;AAAA;;AAAA;AACT,UAAIf,EAAJ,EAAQC,EAAR;;AACA,UAAI,CAACD,EAAE,GAAG,KAAI,CAACM,SAAX,MAA0B,IAA1B,IAAkCN,EAAE,KAAK,KAAK,CAA9C,GAAkD,KAAK,CAAvD,GAA2DA,EAAE,CAACO,2BAAlE,EAA+F;AAC3F,cAAM,KAAI,CAACS,sBAAL,EAAN;AACH;;AACD,UAAI,KAAI,CAACvB,WAAL,CAAiBqB,KAArB,EAA4B;AACxB,cAAMG,2BAA2B,GAAG;AAChCP,UAAAA,EAAE,EAAE5B,MAAM,GAAG6B,WAAT,EAD4B;AAEhCO,UAAAA,aAAa,EAAE,KAAI,CAACZ,SAAL,CAAeI,EAAf,CAAkBC,WAAlB,EAFiB;AAGhCQ,UAAAA,UAAU,EAAE,CAAClB,EAAE,GAAG,KAAI,CAACR,WAAL,CAAiBmB,GAAjB,CAAqB,SAArB,CAAN,MAA2C,IAA3C,IAAmDX,EAAE,KAAK,KAAK,CAA/D,GAAmE,KAAK,CAAxE,GAA4EA,EAAE,CAACa,KAAH,CAASH,WAAT;AAHxD,SAApC;;AAKA,QAAA,KAAI,CAACzB,aAAL,CAAmBkC,sBAAnB,CAA0CH,2BAA1C,EAAuEnB,SAAvE,CAAkFC,GAAD,IAAS;AACtF,cAAIC,EAAJ;;AACA,cAAI,CAACD,GAAG,CAACsB,KAAT,EAAgB;AACZ,kBAAMf,SAAS,GAAGgB,MAAM,CAACC,MAAP,CAAcD,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkB,KAAI,CAACjB,SAAvB,CAAd,EAAiD;AAAEC,cAAAA,2BAA2B,EAAE,CAACP,EAAE,GAAG,KAAI,CAACP,WAAL,CAAiBmB,GAAjB,CAAqB,SAArB,CAAN,MAA2C,IAA3C,IAAmDZ,EAAE,KAAK,KAAK,CAA/D,GAAmE,KAAK,CAAxE,GAA4EA,EAAE,CAACc;AAA9G,aAAjD,CAAlB;;AACA,YAAA,KAAI,CAAC3B,KAAL,CAAWqC,QAAX,CAAoB5C,aAAa,CAAC;AAAE0B,cAAAA,SAAS,EAAEA;AAAb,aAAD,CAAjC;;AACA,YAAA,KAAI,CAACb,WAAL,CAAiBoB,QAAjB,CAA0B,IAA1B;;AACA,YAAA,KAAI,CAACvB,OAAL,CAAamC,IAAb,CAAkB;AACdC,cAAAA,IAAI,EAAE,SADQ;AAEdpC,cAAAA,OAAO,EAAE,6BAFK;AAGdqC,cAAAA,IAAI,EAAE;AAHQ,aAAlB;;AAKA,YAAA,KAAI,CAACtC,QAAL,CAAcoC,IAAd,CAAmB;AACff,cAAAA,EAAE,EAAE,SADW;AAEfkB,cAAAA,IAAI,EAAE,WAFS;AAGfd,cAAAA,KAAK,EAAE;AAHQ,aAAnB;AAKH,WAdD,MAeK;AACD,YAAA,KAAI,CAACxB,OAAL,CAAamC,IAAb,CAAkB;AACdC,cAAAA,IAAI,EAAE,OADQ;AAEdpC,cAAAA,OAAO,EAAES,GAAG,CAACsB,KAFC;AAGdM,cAAAA,IAAI,EAAE;AAHQ,aAAlB;AAKH;AACJ,SAxBD;AAyBH,OA/BD,MAgCK;AACD,cAAMrB,SAAS,GAAGgB,MAAM,CAACC,MAAP,CAAcD,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkB,KAAI,CAACjB,SAAvB,CAAd,EAAiD;AAAEC,UAAAA,2BAA2B,EAAE;AAA/B,SAAjD,CAAlB;;AACA,QAAA,KAAI,CAACpB,KAAL,CAAWqC,QAAX,CAAoB5C,aAAa,CAAC;AAAE0B,UAAAA,SAAS,EAAEA;AAAb,SAAD,CAAjC;;AACA,QAAA,KAAI,CAACjB,QAAL,CAAcoC,IAAd,CAAmB;AACff,UAAAA,EAAE,EAAE,SADW;AAEfkB,UAAAA,IAAI,EAAE,WAFS;AAGfd,UAAAA,KAAK,EAAE;AAHQ,SAAnB;AAKH;AA7CQ;AA8CZ;;AACDE,EAAAA,sBAAsB,GAAG;AACrB,WAAO,IAAIa,OAAJ,CAAY,CAACC,MAAD,EAASC,GAAT,KAAiB;AAChC,WAAK7C,aAAL,CACK8C,yCADL,CAC+C,KAAK1B,SAAL,CAAeI,EAAf,CAAkBC,WAAlB,EAD/C,EACgF,KAAKL,SAAL,CAAeC,2BAAf,CAA2CG,EAA3C,CAA8CC,WAA9C,EADhF,EAEKb,SAFL,CAEgBC,GAAD,IAAS;AACpB,YAAIA,GAAG,CAACsB,KAAR,EACIU,GAAG,CAAC,IAAD,CAAH;AACJD,QAAAA,MAAM,CAAC,CAAC/B,GAAG,CAACsB,KAAN,CAAN;AACH,OAND;AAOH,KARM,CAAP;AASH;;AACDY,EAAAA,MAAM,GAAG;AACL,SAAK5C,QAAL,CAAcoC,IAAd,CAAmB;AACff,MAAAA,EAAE,EAAE,SADW;AAEfkB,MAAAA,IAAI,EAAE,WAFS;AAGfd,MAAAA,KAAK,EAAE;AAHQ,KAAnB;AAKH;;AA7F2D,CAAhE;;AA+FAxC,UAAU,CAAC,CACPG,KAAK,EADE,CAAD,EAEPM,yBAAyB,CAACmD,SAFnB,EAE8B,WAF9B,EAE2C,KAAK,CAFhD,CAAV;;AAGA5D,UAAU,CAAC,CACPI,MAAM,EADC,CAAD,EAEPK,yBAAyB,CAACmD,SAFnB,EAE8B,UAF9B,EAE0C,KAAK,CAF/C,CAAV;;AAGA5D,UAAU,CAAC,CACPI,MAAM,EADC,CAAD,EAEPK,yBAAyB,CAACmD,SAFnB,EAE8B,SAF9B,EAEyC,KAAK,CAF9C,CAAV;;AAGAnD,yBAAyB,GAAGT,UAAU,CAAC,CACnCC,SAAS,CAAC;AACN4D,EAAAA,QAAQ,EAAE,wBADJ;AAENC,EAAAA,WAAW,EAAE,qCAFP;AAGNC,EAAAA,SAAS,EAAE,CAAC,qCAAD;AAHL,CAAD,CAD0B,CAAD,EAMnCtD,yBANmC,CAAtC;AAOA,SAASA,yBAAT","sourcesContent":["import { __decorate } from \"tslib\";\r\nimport { Component, EventEmitter, Input, Output } from '@angular/core';\r\nimport { FormControl } from \"@angular/forms\";\r\nimport { editAttribute } from \"@app/core/store/actions/entity.action\";\r\nimport { v4 as uuidv4 } from 'uuid';\r\nlet EntityAddDatasetComponent = class EntityAddDatasetComponent {\r\n    constructor(datasetsService, entityService, store, _fb) {\r\n        this.datasetsService = datasetsService;\r\n        this.entityService = entityService;\r\n        this.store = store;\r\n        this._fb = _fb;\r\n        this.onSubmit = new EventEmitter();\r\n        this.message = new EventEmitter();\r\n        this.datasets = [];\r\n        this.datasetsLoaded = false;\r\n        this.datasetForm = this._fb.group({\r\n            dataset: new FormControl(null)\r\n        });\r\n    }\r\n    ngOnInit() {\r\n        this.datasetsService.getDatasets().subscribe((res) => {\r\n            var _a, _b, _c;\r\n            this.datasets = res.data;\r\n            this.datasetsLoaded = true;\r\n            console.log(this.datasets);\r\n            if ((_a = this.attribute) === null || _a === void 0 ? void 0 : _a.entities_attributes_dataset) {\r\n                const dataset = this.datasets.find((dts) => dts.id.toLowerCase() === this.attribute.entities_attributes_dataset.id.toLowerCase());\r\n                (_b = this.datasetForm.get('dataset')) === null || _b === void 0 ? void 0 : _b.setValue(dataset);\r\n            }\r\n            else {\r\n                (_c = this.datasetForm.get('dataset')) === null || _c === void 0 ? void 0 : _c.value.setValue(null);\r\n            }\r\n        });\r\n    }\r\n    async save() {\r\n        var _a, _b;\r\n        if ((_a = this.attribute) === null || _a === void 0 ? void 0 : _a.entities_attributes_dataset) {\r\n            await this.deleteAttributeDataset();\r\n        }\r\n        if (this.datasetForm.value) {\r\n            const attributeDatasetPersistence = {\r\n                id: uuidv4().toLowerCase(),\r\n                attributes_id: this.attribute.id.toLowerCase(),\r\n                dataset_id: (_b = this.datasetForm.get('dataset')) === null || _b === void 0 ? void 0 : _b.value.toLowerCase(),\r\n            };\r\n            this.entityService.createAttributeDataset(attributeDatasetPersistence).subscribe((res) => {\r\n                var _a;\r\n                if (!res.error) {\r\n                    const attribute = Object.assign(Object.assign({}, this.attribute), { entities_attributes_dataset: (_a = this.datasetForm.get('dataset')) === null || _a === void 0 ? void 0 : _a.value });\r\n                    this.store.dispatch(editAttribute({ attribute: attribute }));\r\n                    this.datasetForm.setValue(null);\r\n                    this.message.emit({\r\n                        type: 'success',\r\n                        message: 'Cambios guardados con éxito',\r\n                        life: 5000\r\n                    });\r\n                    this.onSubmit.emit({\r\n                        id: 'dataset',\r\n                        from: 'attribute',\r\n                        value: true\r\n                    });\r\n                }\r\n                else {\r\n                    this.message.emit({\r\n                        type: 'error',\r\n                        message: res.error,\r\n                        life: 5000\r\n                    });\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            const attribute = Object.assign(Object.assign({}, this.attribute), { entities_attributes_dataset: null });\r\n            this.store.dispatch(editAttribute({ attribute: attribute }));\r\n            this.onSubmit.emit({\r\n                id: 'dataset',\r\n                from: 'attribute',\r\n                value: true\r\n            });\r\n        }\r\n    }\r\n    deleteAttributeDataset() {\r\n        return new Promise((resolv, rej) => {\r\n            this.entityService\r\n                .DeleteAttributeDatasetByAttIDAndDatasetID(this.attribute.id.toLowerCase(), this.attribute.entities_attributes_dataset.id.toLowerCase())\r\n                .subscribe((res) => {\r\n                if (res.error)\r\n                    rej(true);\r\n                resolv(!res.error);\r\n            });\r\n        });\r\n    }\r\n    cancel() {\r\n        this.onSubmit.emit({\r\n            id: 'dataset',\r\n            from: 'attribute',\r\n            value: true\r\n        });\r\n    }\r\n};\r\n__decorate([\r\n    Input()\r\n], EntityAddDatasetComponent.prototype, \"attribute\", void 0);\r\n__decorate([\r\n    Output()\r\n], EntityAddDatasetComponent.prototype, \"onSubmit\", void 0);\r\n__decorate([\r\n    Output()\r\n], EntityAddDatasetComponent.prototype, \"message\", void 0);\r\nEntityAddDatasetComponent = __decorate([\r\n    Component({\r\n        selector: 'app-entity-add-dataset',\r\n        templateUrl: './entity-add-dataset.component.html',\r\n        styleUrls: ['./entity-add-dataset.component.scss']\r\n    })\r\n], EntityAddDatasetComponent);\r\nexport { EntityAddDatasetComponent };\r\n"]},"metadata":{},"sourceType":"module"}