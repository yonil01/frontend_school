<div class="w-full flex" style="height: calc(100vh - 3rem)">
  <div class="w-12 h-full bg-mono-10">
    <div class="h-12 w-full flex items-center justify-center cursor-pointer {{typeTask === 'TIMER' ? 'b-solid' : 'b-ghost'}}" ecTooltip tooltip="Tareas de tipo Timer" (click)="setTypeTask('timer')">
      <svg width="24" height="24" viewBox="0 0 24 24" class="fill-current" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 5C16.6944 5 20.5 8.80558 20.5 13.5C20.5 18.1944 16.6944 22 12 22C7.30558 22 3.5 18.1944 3.5 13.5C3.5 8.80558 7.30558 5 12 5ZM12 6.5C8.13401 6.5 5 9.63401 5 13.5C5 17.366 8.13401 20.5 12 20.5C15.866 20.5 19 17.366 19 13.5C19 9.63401 15.866 6.5 12 6.5ZM12 8C12.3797 8 12.6935 8.28215 12.7432 8.64823L12.75 8.75V13.25C12.75 13.6642 12.4142 14 12 14C11.6203 14 11.3065 13.7178 11.2568 13.3518L11.25 13.25V8.75C11.25 8.33579 11.5858 8 12 8ZM19.1472 5.11371L19.2298 5.17355L20.3882 6.13773C20.7066 6.40272 20.7498 6.87562 20.4849 7.19398C20.2419 7.48581 19.8243 7.54649 19.5112 7.35047L19.4286 7.29063L18.2702 6.32645C17.9518 6.06146 17.9086 5.58856 18.1735 5.2702C18.4165 4.97837 18.8341 4.91769 19.1472 5.11371ZM14.25 2.5C14.6642 2.5 15 2.83579 15 3.25C15 3.6297 14.7178 3.94349 14.3518 3.99315L14.25 4H9.75C9.33579 4 9 3.66421 9 3.25C9 2.8703 9.28215 2.55651 9.64823 2.50685L9.75 2.5H14.25Z"/>
      </svg>
    </div>
    <div class="h-12 w-full flex items-center justify-center cursor-pointer {{typeTask === 'SYSTEM' ? 'b-solid' : 'b-ghost'}}" ecTooltip tooltip="Tareas de tipo Systema" (click)="setTypeTask('system')">
      <svg width="24" height="24" viewBox="0 0 24 24" class="fill-current" xmlns="http://www.w3.org/2000/svg">
        <path d="M2.75098 16.4998H21.2497C21.6639 16.4998 21.9997 16.8356 21.9997 17.2498C21.9997 17.6295 21.7176 17.9433 21.3515 17.993L21.2497 17.9998H2.75098C2.33676 17.9998 2.00098 17.664 2.00098 17.2498C2.00098 16.8701 2.28313 16.5563 2.64921 16.5067L2.75098 16.4998H21.2497H2.75098ZM18.2504 5.00034C19.2168 5.00034 20.0004 5.78384 20.0004 6.75034V14.2506C20.0004 15.2171 19.2168 16.0006 18.2504 16.0006H5.75035C4.78385 16.0006 4.00035 15.2171 4.00035 14.2506V6.75034C4.00035 5.78384 4.78385 5.00034 5.75035 5.00034H18.2504ZM18.2504 6.50034H5.75035C5.61228 6.50034 5.50035 6.61226 5.50035 6.75034V14.2506C5.50035 14.3887 5.61228 14.5006 5.75035 14.5006H18.2504C18.3884 14.5006 18.5004 14.3887 18.5004 14.2506V6.75034C18.5004 6.61226 18.3884 6.50034 18.2504 6.50034Z"/>
      </svg>
    </div>
    <div class="h-12 w-full flex items-center justify-center cursor-pointer {{typeTask === 'USER' ? 'b-solid' : 'b-ghost'}}" ecTooltip tooltip="Tareas de tipo Usuario" (click)="setTypeTask('user')">
      <span appIcon iconName="person"></span>
    </div>
  </div>
  <div class="flex-1 h-full p-12">
    <div>
      <div *ngIf="showView === 'list'">
        <div class="t-body-1 text-black dark:text-white mb-12 font-bold">
          <span>{{'EXECUTIONS' | translate}} ({{typeTask | translate}})</span>
        </div>

        <div *ngIf="tasks.length && tasksDisplay.length" class="flex w-full items-center justify-between mb-6">
          <button class="b-outline rounded-md" (click)="showView = 'createOrUpdate'; operation = 'add'">{{'NEW_TASK_TYPE_' + typeTask |  translate}}</button>
          <div><input [disabled]="tasks.length <= 0 " class="ec-input w-full md:w-48" type="text" placeholder="{{'FIND_TASK' | translate}}"
                      (input)="filterItemsTarget($event)"></div>
        </div>

        <div *ngIf="tasks.length && tasksDisplay.length" class="w-full">
          <div class="table-h hidden md:block w-full">
            <div class="table-head border-b border-brand-2 flex flex-row t-caption-1 text-brand-2">
              <div class="p-2 w-16">N°</div>
              <div class="p-2 flex-1">{{'NAME' | translate}}</div>
              <div class="p-2 flex-1">{{'TYPE_TASK' | translate}}</div>
              <div class="p-2 w-32 flex items-center justify-center">{{'OPTIONS' | translate}}</div>
            </div>
            <div class="table-body text-body-2 text-mono-70">
              <div *ngFor="let task of tasksPagination, let i = index" class="register-table w-full flex flex-row">
                <div class="flex items-center p-2 w-16">{{i + 1}}</div>
                <div class="flex items-center p-2 flex-1 break-all">{{task.name}}</div>
                <div class="flex items-center p-2 flex-1 break-all" *ngIf="task.type === 1">{{'SYSTEM' | translate}}</div>
                <div class="flex items-center p-2 flex-1 break-all" *ngIf="task.type === 2">{{'TIMER' | translate}}</div>
                <div class="flex items-center p-2 flex-1 break-all" *ngIf="task.type === 3">{{'USER' | translate}}</div>
                <div class="flex items-center p-2 w-32">
                  <div class="w-full flex flex-row">
                    <button class="w-10 text-alert-info px-2 h-10 hover:bg-mono-10" (click)="editExecution(task)">
                      <div>
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path
                            d="M21.0303 2.96967C22.4278 4.36713 22.4278 6.63286 21.0303 8.03033L9.06198 19.9987C8.7851 20.2755 8.44076 20.4754 8.063 20.5784L2.94731 21.9736C2.38744 22.1263 1.87371 21.6125 2.0264 21.0527L3.42159 15.937C3.52462 15.5592 3.72444 15.2149 4.00132 14.938L15.9696 2.96967C17.3671 1.5722 19.6328 1.5722 21.0303 2.96967ZM15.0001 6.06057L5.06198 15.9987C4.96969 16.0909 4.90308 16.2057 4.86874 16.3316L3.81889 20.1811L7.66833 19.1312C7.79425 19.0969 7.90903 19.0303 8.00132 18.938L17.9391 8.99957L15.0001 6.06057ZM17.0303 4.03033L16.0601 4.99957L18.9991 7.93957L19.9696 6.96967C20.7813 6.15799 20.7813 4.842 19.9696 4.03033C19.158 3.21865 17.842 3.21865 17.0303 4.03033Z"
                            fill="#0150E5"/>
                        </svg>
                      </div>
                    </button>
                    <button class="w-10 text-alert-error px-2 h-10 hover:bg-mono-10" (click)="executionSelected = task; showAlert = true">
                      <div>
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path
                            d="M12 1.75C13.733 1.75 15.1492 3.10645 15.2449 4.81558L15.25 5H20.5C20.9142 5 21.25 5.33579 21.25 5.75C21.25 6.1297 20.9678 6.44349 20.6018 6.49315L20.5 6.5H19.704L18.4239 19.5192C18.2912 20.8683 17.1984 21.91 15.8626 21.9945L15.6871 22H8.31293C6.95734 22 5.81365 21.0145 5.59883 19.6934L5.57614 19.5192L4.295 6.5H3.5C3.1203 6.5 2.80651 6.21785 2.75685 5.85177L2.75 5.75C2.75 5.3703 3.03215 5.05651 3.39823 5.00685L3.5 5H8.75C8.75 3.20507 10.2051 1.75 12 1.75ZM18.197 6.5H5.802L7.06893 19.3724C7.12768 19.9696 7.60033 20.4343 8.18585 20.4936L8.31293 20.5H15.6871C16.2872 20.5 16.7959 20.0751 16.9123 19.4982L16.9311 19.3724L18.197 6.5ZM13.75 9.25C14.1297 9.25 14.4435 9.53215 14.4932 9.89823L14.5 10V17C14.5 17.4142 14.1642 17.75 13.75 17.75C13.3703 17.75 13.0565 17.4678 13.0068 17.1018L13 17V10C13 9.58579 13.3358 9.25 13.75 9.25ZM10.25 9.25C10.6297 9.25 10.9435 9.53215 10.9932 9.89823L11 10V17C11 17.4142 10.6642 17.75 10.25 17.75C9.8703 17.75 9.55651 17.4678 9.50685 17.1018L9.5 17V10C9.5 9.58579 9.83579 9.25 10.25 9.25ZM12 3.25C11.0818 3.25 10.3288 3.95711 10.2558 4.85647L10.25 5H13.75C13.75 4.0335 12.9665 3.25 12 3.25Z"
                            fill="#CA1C25"/>
                        </svg>
                      </div>
                    </button>
                    <button class="w-10 text-alert-error px-2 h-10 hover:bg-mono-10" (click)="showActivities(task)">
                      <div>
                        <svg width="18" height="20" viewBox="0 0 18 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path
                            d="M14 0.49823C15.934 0.49823 17.5018 2.06603 17.5018 4C17.5018 5.93397 15.934 7.50177 14 7.50177C12.97 7.50177 12.0439 7.0571 11.4032 6.34927L6.84455 8.9537C6.94786 9.2841 7.00354 9.63555 7.00354 10C7.00354 10.3644 6.94786 10.7159 6.84455 11.0463L11.4023 13.6517C12.043 12.9433 12.9695 12.4982 14 12.4982C15.934 12.4982 17.5018 14.066 17.5018 16C17.5018 17.934 15.934 19.5018 14 19.5018C12.066 19.5018 10.4982 17.934 10.4982 16C10.4982 15.6355 10.5539 15.2841 10.6572 14.9537L6.09951 12.3483C5.45873 13.0567 4.53223 13.5018 3.50177 13.5018C1.5678 13.5018 0 11.934 0 10C0 8.06602 1.5678 6.49823 3.50177 6.49823C4.53173 6.49823 5.45784 6.94289 6.09859 7.65072L10.6572 5.0463C10.5539 4.7159 10.4982 4.36445 10.4982 4C10.4982 2.06603 12.066 0.49823 14 0.49823ZM14 13.9982C12.8945 13.9982 11.9982 14.8945 11.9982 16C11.9982 17.1055 12.8945 18.0018 14 18.0018C15.1055 18.0018 16.0018 17.1055 16.0018 16C16.0018 14.8945 15.1055 13.9982 14 13.9982ZM3.50177 7.99823C2.39622 7.99823 1.5 8.89445 1.5 10C1.5 11.1055 2.39622 12.0018 3.50177 12.0018C4.60732 12.0018 5.50354 11.1055 5.50354 10C5.50354 8.89445 4.60732 7.99823 3.50177 7.99823ZM14 1.99823C12.8945 1.99823 11.9982 2.89445 11.9982 4C11.9982 5.10555 12.8945 6.00177 14 6.00177C15.1055 6.00177 16.0018 5.10555 16.0018 4C16.0018 2.89445 15.1055 1.99823 14 1.99823Z"
                            fill="#CC8700"/>
                        </svg>
                      </div>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <app-paginator [data]="tasksDisplay" (current-data-page)="tasksPagination = $event"></app-paginator>
        </div>

        <div *ngIf="!tasksDisplay.length" class="w-full flex flex-col items-center justify-center text-brand-d-1 text-xl font-bold gap-6">
          <span>{{'THERE_ARE_NO_'+typeTask+'_TASKS' | translate}}!</span>
          <button class="b-outline rounded-md" (click)="showView = 'createOrUpdate'; operation = 'add'">{{'NEW_TASK_TYPE_' + typeTask | translate}}</button>
        </div>
      </div>

      <div *ngIf="showView ==='createOrUpdate'">
        <app-task-form [queue]="parentQueue" [roles]="roles" (cancel-form)="cancelCreateOrEdit()" (save-task)="saveTask($event)" (save-role)="saveExecutionRole($event)" [typeTask]="typeTask"></app-task-form>
        <!--<div class="flex gap-4 mb-12">
          <div class="flex gap-1 items-center" *ngFor="let step of steps; let position = index">
            <div class="rounded-full h-8 w-8 {{step.active ? 'bg-brand-l-1 text-white' : 'bg-mono-10 text-black'}} flex items-center justify-center"><span>{{position + 1}}</span></div>
            <div class="text-brand-d-1 t-caption-1">
              <span>{{step.name | translate}}</span>
            </div>
          </div>
        </div>
        <div class="flex flex-col  space-y-12" *ngIf="positionStep === 0">
          <span class="t-h5 text-black dark:text-white">{{(operation === 'add' ? 'CREATE' : 'EDIT') | translate}} {{'EXECUTION' | translate}}</span>
          <form [formGroup]="taskForm" class=" grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4">
            <div class="input flex flex-col space-y-1">
              <label class="t-caption-2 text-mono-70">{{'NAME' | translate}}</label>
              <input class="ec-input" type="text" formControlName="name">
              <div class="text-alert-error"
                   *ngIf="taskForm.get('name')?.invalid && taskForm.get('name')?.touched && taskForm.get('name')?.hasError('required')">
                <span>El campo es requerido</span>
              </div>
              <div class="text-alert-error"
                   *ngIf="taskForm.get('name')?.invalid && taskForm.get('name')?.touched && taskForm.get('name')?.hasError('maxlength')">
                <span>El tamaño del campo no puede ser mayor a 50 caracteres</span>
              </div>
              <div class="text-alert-error"
                   *ngIf="taskForm.get('name')?.invalid && taskForm.get('name')?.touched && taskForm.get('name')?.hasError('minlength')">
                <span>El tamaño del campo no puede ser menor a 3 caracteres</span>
              </div>
            </div>
            <div class="input flex flex-col space-y-1">
              <label class="t-caption-2 text-mono-70">{{'ICON' | translate}}</label>
              <ec-dropdown [filter]="true" class="font-icon-material" placeholder="{{'SELECT_ICON' | translate}}" formControlName="class" [icon]="true" optionLabel="label" [data]="icons" [dropStyle]="dropStyle"></ec-dropdown>
              <div class="text-alert-error"
                   *ngIf="taskForm.get('class')?.invalid && taskForm.get('class')?.touched && taskForm.get('class')?.hasError('required')">
                <span>El campo es requerido</span>
              </div>
            </div>
            <div class="input flex flex-col space-y-1">
              <label class="t-caption-2 text-mono-70">{{'TYPE_EXECUTION' | translate}}</label>
              <ec-dropdown [filter]="true" placeholder="{{'SELECT_TYPE_EXECUTION' | translate}}" formControlName="type" [icon]="true" optionLabel="label" [data]="typesTasks" [dropStyle]="dropStyle" (onChangeValue)="activeTimers($event)"></ec-dropdown>
              <div class="text-alert-error"
                   *ngIf="taskForm.get('type')?.invalid && taskForm.get('type')?.touched && taskForm.get('type')?.hasError('required')">
                <span>El campo es requerido</span>
              </div>
            </div>
            <div class="input flex flex-col space-y-1" *ngIf="taskForm.get('type')?.value === 2">
              <label class="t-caption-2 text-mono-70">{{'TIMERS' | translate}}</label>
              <ec-dropdown [filter]="true" placeholder="{{'SELECT_TIMER' | translate}}" formControlName="timer" [icon]="true" optionLabel="label" [data]="timers" [dropStyle]="dropStyle"></ec-dropdown>
              <div class="text-alert-error"
                   *ngIf="taskForm.get('timer')?.invalid && taskForm.get('timer')?.touched && taskForm.get('timer')?.hasError('required')">
                <span>El campo es requerido</span>
              </div>
            </div>
            <div class="input flex flex-col space-y-1 col-span-2">
              <label class="t-caption-2 text-mono-70">{{'DESCRIPTION' | translate}}</label>
              <textarea class="ec-input" style="height: 5rem!important;" formControlName="description"></textarea>
              <div class="text-alert-error"
                   *ngIf="taskForm.get('description')?.invalid && taskForm.get('description')?.touched && taskForm.get('description')?.hasError('required')">
                <span>El campo es requerido</span>
              </div>
              <div class="text-alert-error"
                   *ngIf="taskForm.get('description')?.invalid && taskForm.get('description')?.touched && taskForm.get('description')?.hasError('maxlength')">
                <span>El tamaño del campo no puede ser mayor a 8000 caracteres</span>
              </div>
              <div class="text-alert-error"
                   *ngIf="taskForm.get('description')?.invalid && taskForm.get('description')?.touched && taskForm.get('description')?.hasError('minlength')">
                <span>El tamaño del campo no puede ser menor a 3 caracteres!</span>
              </div>
            </div>
          </form>
          <div class="flex flex-row space-x-4 lg:w-2/3 ">
            <button class="flex-1 md:flex-none b-outline" (click)="cancelCreateOrEdit()">{{'CANCEL' | translate}}</button>
            <button class="flex-1 md:flex-none b-solid" (click)="saveTask()">{{'SAVE' | translate}}</button>
          </div>
        </div>
        <div *ngIf="positionStep === 1 && taskForm.get('type')?.value === 3">
          <div class="flex w-full items-center justify-between mb-5">
            &lt;!&ndash;<button class="b-outline">{{'SELECT_ALL' |  translate}}</button>&ndash;&gt;
            <div><input class="ec-input w-full md:w-48" type="text" placeholder="{{'FIND_ROL' | translate}}"
                        (input)="filterRoles($event)"></div>
          </div>
          <div class="w-full">
            <div class="table-h hidden md:block w-full">
              <div class="table-head border-b border-brand-2 flex flex-row t-caption-1 text-brand-2">
                <div class="p-2 w-16">N°</div>
                <div class="p-2 flex-1">{{'ROLE_ALLOWED' | translate}}</div>
                <div class="p-2 w-32 flex items-center justify-center">{{'SELECT' | translate}}</div>
              </div>
              <div class="table-body text-body-2 text-mono-70">
                <div *ngFor="let rol of rolesPagination, let i = index" class="register-table w-full flex flex-row">
                  <div class="flex items-center p-2 w-16">{{i + 1}}</div>
                  <div class="flex items-center p-2 flex-1 break-all">{{rol.role.name}}</div>
                  <div class="flex items-center p-2 w-32 justify-center">
                    <ec-checkbox color="text-brand-d-1" [ec-value]="rol.active" (ec-change)="changeRole($event, rol.role.id || '')"></ec-checkbox>
                  </div>
                </div>
              </div>
            </div>
            <app-paginator [data]="rolesDisplay" (current-data-page)="rolesPagination = $event"></app-paginator>
          </div>
          <div class="flex flex-row space-x-4 lg:w-2/3 mt-4">
            <button class="flex-1 md:flex-none b-outline" (click)="backStep()">{{'BACK' | translate}}</button>
            <button class="flex-1 md:flex-none b-solid" (click)="cancelCreateOrEdit()">
              {{'EXIT' | translate}}</button>
          </div>
        </div>-->
      </div>

      <div *ngIf="showView === 'activities'">
        <app-activities [executionInput]="task" [executions]="tasks" (backTasks)="backTasks($event)"></app-activities>
      </div>

    </div>
  </div>
</div>


<app-confirm-dialog [show]="showAlert" (onEvent)="deleteExecution($event)" type="warning"
                    body="¿Desea eliminar esta ejecución?"></app-confirm-dialog>

<ec-toast [toastStyle]="toastStyle"></ec-toast>
<app-block-page [show]="blockPage"></app-block-page>
